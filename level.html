<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ZenSite | Level Up</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#050505;
    --glass:rgba(18,18,18,.88);
    --line:rgba(255,255,255,.12);
    --muted:rgba(255,255,255,.78);
    --muted2:rgba(255,255,255,.55);
    --r:26px;

    --pro:#d9d9d9;
    --vip:#ffd700;
    --elite:#7efcff;
  }

  html,body{height:100%}
  html,body{touch-action:manipulation;-webkit-text-size-adjust:100%}
  body{
    font-family:'Inter',system-ui;
    background:
      radial-gradient(900px 520px at 50% 0%, rgba(255,255,255,.06), transparent 62%),
      radial-gradient(900px 520px at 20% 85%, rgba(255,215,0,.10), transparent 66%),
      radial-gradient(900px 520px at 80% 85%, rgba(126,252,255,.08), transparent 70%),
      var(--bg);
    color:#fff;
    overflow-x:hidden;
  }

  /* ===== TOP ===== */
  .header{
    position:fixed; inset:0 0 auto 0;
    padding:18px 24px;
    display:flex; align-items:center; justify-content:space-between;
    background:linear-gradient(to bottom,rgba(0,0,0,.9),rgba(0,0,0,.45),transparent);
    z-index:1000;
  }
  .brand{
    font-weight:950;
    letter-spacing:.4px;
    opacity:.95;
  }
  .right{
    display:flex; align-items:center; gap:12px;
  }
  .lang{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px;
    border-radius:999px;
    border:1px solid var(--line);
    background:rgba(0,0,0,.35);
    backdrop-filter: blur(12px);
  }
  .lang span{
    cursor:pointer; user-select:none;
    font-weight:900;
    opacity:.45;
    letter-spacing:.4px;
  }
  .lang span.active{opacity:1}
  .pill{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid var(--line);
    background:rgba(0,0,0,.35);
    backdrop-filter: blur(12px);
    font-weight:900;
    letter-spacing:.4px;
    font-size:12px;
    opacity:.92;
    display:flex; gap:8px; align-items:center;
  }
  .pill b{font-weight:950}

  /* ===== LAYOUT ===== */
  .wrap{
    max-width:1150px;
    margin:0 auto;
    padding:120px 7% 90px;
  }

  /* ===== HERO ===== */
  .hero{
    display:flex; justify-content:space-between; align-items:flex-end;
    gap:18px; flex-wrap:wrap;
    margin-bottom:22px;
  }
  .hero h1{
    font-family:'Playfair Display',serif;
    font-size:clamp(40px,6vw,72px);
    letter-spacing:.02em;
    line-height:1.03;
  }
  .hero p{
    max-width:720px;
    margin-top:14px;
    font-size:16.5px;
    color:var(--muted);
    line-height:1.75;
  }
  .statusLine{
    opacity:.75;
    font-weight:800;
    letter-spacing:.12em;
    text-transform:uppercase;
    font-size:12px;
    padding:10px 12px;
    border-radius:999px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.06);
    backdrop-filter: blur(12px);
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(12,1fr);
    gap:16px;
    margin-top:18px;
  }
  .card{
    background:var(--glass);
    border:1px solid var(--line);
    border-radius:var(--r);
    padding:18px;
    backdrop-filter: blur(14px);
    box-shadow:0 28px 90px rgba(0,0,0,.65);
    position:relative;
    overflow:hidden;
    transform:translateY(10px);
    opacity:0;
    animation:in .7s ease forwards;
  }
  .card:nth-child(2){animation-delay:.06s}
  .card:nth-child(3){animation-delay:.12s}
  .card:nth-child(4){animation-delay:.18s}
  .card:nth-child(5){animation-delay:.24s}
  @keyframes in{to{transform:translateY(0);opacity:1}}

  .card::after{
    content:"";
    position:absolute; inset:-2px;
    background:radial-gradient(700px 260px at 20% 0%, rgba(255,255,255,.10), transparent 60%);
    pointer-events:none;
    opacity:.65;
  }

  .col-7{grid-column:span 7}
  .col-5{grid-column:span 5}
  .col-12{grid-column:span 12}
  @media (max-width:900px){
    .col-7,.col-5{grid-column:span 12}
  }

  /* ===== XP HUD ===== */
  .hudTop{
    display:flex; justify-content:space-between; align-items:flex-end; gap:12px;
    margin-bottom:12px;
  }
  .rank{
    font-weight:950;
    letter-spacing:.18em;
    text-transform:uppercase;
    font-size:12px;
    opacity:.92;
  }
  .next{
    font-weight:900;
    letter-spacing:.12em;
    text-transform:uppercase;
    font-size:11px;
    opacity:.72;
    text-align:right;
  }

  .bar{
    height:14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.10);
    overflow:hidden;
    position:relative;
  }
  .fill{
    height:100%;
    width:0%;
    border-radius:999px;
    background:linear-gradient(90deg,#fff,#bbb,#fff);
    box-shadow:0 0 30px rgba(255,255,255,.18);
    transition:width .95s cubic-bezier(.2,.9,.2,1);
    position:relative;
  }
  .fill::after{
    content:"";
    position:absolute; inset:0;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
    transform:translateX(-60%);
    animation:sheen 2.8s ease-in-out infinite;
    opacity:.55;
  }
  @keyframes sheen{
    0%{transform:translateX(-70%)}
    50%{transform:translateX(70%)}
    100%{transform:translateX(70%)}
  }

  body.pro .fill{
    background:linear-gradient(90deg,#fff,var(--pro),#fff);
    box-shadow:0 0 34px rgba(255,255,255,.22);
  }
  body.vip .fill{
    background:linear-gradient(90deg,#fff,var(--vip),#fff);
    box-shadow:0 0 38px rgba(255,215,0,.25);
  }
  body.elite .fill{
    background:linear-gradient(90deg,#fff,var(--elite),#fff);
    box-shadow:0 0 42px rgba(126,252,255,.22);
  }

  .tags{
    margin-top:12px;
    display:flex; flex-wrap:wrap; gap:10px;
  }
  .tag{
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.25);
    font-size:11px;
    letter-spacing:.10em;
    opacity:.9;
  }
  .tag b{opacity:1}

  .shake{animation:shake .35s ease}
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-3px)}
    50%{transform:translateX(3px)}
    75%{transform:translateX(-2px)}
  }

  /* ===== MISSIONS ===== */
  .head{
    display:flex; justify-content:space-between; align-items:flex-end; gap:12px;
    margin-bottom:12px;
  }
  .head h3{
    font-weight:950;
    letter-spacing:.22em;
    text-transform:uppercase;
    font-size:12px;
    opacity:.92;
  }
  .head span{
    font-size:12px;
    opacity:.65;
  }

  .mission{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:14px 12px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.25);
    margin-bottom:10px;
    transition:transform .25s ease, border-color .25s ease, background .25s ease;
  }
  .mission:hover{
    transform:translateY(-2px);
    border-color:rgba(255,255,255,.20);
    background:rgba(255,255,255,.06);
  }
  .mTxt{display:flex; flex-direction:column; gap:4px}
  .mTxt strong{font-size:13px; letter-spacing:.02em}
  .mTxt small{font-size:12px; opacity:.68; line-height:1.35}
  .btn{
    border:none;
    cursor:pointer;
    padding:11px 14px;
    border-radius:999px;
    background:#fff;
    color:#000;
    font-weight:950;
    font-size:11px;
    letter-spacing:.14em;
    text-transform:uppercase;
    transition:transform .12s ease, filter .2s ease;
    white-space:nowrap;
  }
  .btn:active{transform:scale(.98)}
  .btn[disabled]{opacity:.35; cursor:not-allowed}

  /* ===== LEVELS ===== */
  .levels h3{
    font-weight:950;
    letter-spacing:.22em;
    text-transform:uppercase;
    font-size:12px;
    margin-bottom:12px;
    opacity:.92;
  }
  .lGrid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:14px;
  }
  @media (max-width:900px){.lGrid{grid-template-columns:1fr}}

  .level{
    border-radius:22px;
    padding:18px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.25);
    position:relative;
    overflow:hidden;
    transition:transform .25s ease, box-shadow .35s ease, border-color .35s ease;
  }
  .level:hover{transform:translateY(-2px)}
  .level::before{
    content:"";
    position:absolute; inset:-1px;
    background:radial-gradient(460px 200px at 25% 0%, rgba(255,255,255,.10), transparent 60%);
    opacity:.6;
    pointer-events:none;
  }
  .badge{
    position:absolute; top:14px; right:14px;
    padding:7px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    font-size:10px;
    letter-spacing:.14em;
    opacity:.88;
    text-transform:uppercase;
    font-weight:900;
  }
  .level h4{
    font-weight:950;
    letter-spacing:.18em;
    text-transform:uppercase;
    font-size:12px;
    margin-bottom:10px;
  }
  .level ul{list-style:none; font-size:13px; opacity:.78; line-height:1.65}
  .level ul li{margin-bottom:6px}

  .now{
    outline:2px solid rgba(255,255,255,.45);
    box-shadow:0 0 70px rgba(255,255,255,.10);
  }
  .vipPlan{border-color:rgba(255,215,0,.22)}
  .elitePlan{border-color:rgba(126,252,255,.20)}

  .crown{
    position:absolute; left:16px; top:14px;
    font-size:22px;
    opacity:.12;
    transform:translateY(-6px) scale(.92);
    transition:opacity .35s ease, transform .35s ease, filter .35s ease;
    pointer-events:none;
  }
  .vipOn .crown{
    opacity:1;
    transform:translateY(0) scale(1);
    filter:drop-shadow(0 0 18px rgba(255,215,0,.55));
    animation:float 2.6s ease-in-out infinite;
  }
  @keyframes float{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-4px) scale(1.02)}}

  .eliteOrb{
    position:absolute; left:14px; bottom:14px;
    width:46px; height:46px; border-radius:999px;
    background:radial-gradient(circle at 30% 30%, rgba(126,252,255,.55), rgba(126,252,255,.10), transparent 65%);
    opacity:.08;
    filter:blur(.2px);
    transition:opacity .35s ease, filter .35s ease;
    pointer-events:none;
  }
  .eliteOn .eliteOrb{
    opacity:1;
    filter:drop-shadow(0 0 18px rgba(126,252,255,.45));
    animation:orb 3.2s ease-in-out infinite;
  }
  @keyframes orb{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

  /* ===== PORTALS (optional actions) ===== */
  .portals{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:14px;
    margin-top:8px;
  }
  @media (max-width:900px){.portals{grid-template-columns:1fr}}
  .portal{
    border-radius:22px;
    padding:18px;
    border:1px solid rgba(255,255,255,.12);
    background:
      radial-gradient(420px 220px at 20% 0%, rgba(255,255,255,.10), transparent 60%),
      rgba(0,0,0,.25);
    position:relative;
    overflow:hidden;
  }
  .portal h4{
    font-weight:950;
    letter-spacing:.14em;
    text-transform:uppercase;
    font-size:12px;
    margin-bottom:10px;
    opacity:.92;
  }
  .portal p{
    color:var(--muted);
    font-size:13px;
    line-height:1.7;
    opacity:.9;
    margin-bottom:12px;
  }
  .portal .btn{
    display:inline-block;
    text-decoration:none;
    padding:12px 16px;
  }

  /* ===== TOAST ===== */
  .toast{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:18px;
    width:calc(100% - 36px);
    max-width:560px;
    padding:14px 16px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(0,0,0,.72);
    backdrop-filter:blur(18px);
    box-shadow:0 20px 70px rgba(0,0,0,.7);
    display:none;
    z-index:2000;
  }
  .toast.show{display:flex}
  .toast b{letter-spacing:.12em; font-weight:950}
  .toast span{opacity:.75; margin-left:8px}

  /* ===== CONFETTI ===== */
  #fx{
    position:fixed; inset:0;
    pointer-events:none;
    z-index:2500;
  }

  /* ===== FOOTER ===== */
  footer{
    margin-top:70px;
    padding:30px 12px;
    text-align:center;
    font-size:13px;
    opacity:.55;
    border-top:1px solid rgba(255,255,255,.10);
  }
</style>
</head>

<body>

<canvas id="fx"></canvas>

<header class="header">
  <div class="brand">ZenSite</div>
  <div class="right">
    <div class="pill"><span data-es="XP" data-en="XP">XP</span>: <b id="xp">0</b></div>
    <div class="pill"><span data-es="Racha" data-en="Streak">Racha</span>: <b id="streak">0</b> üî•</div>
    <div class="lang" aria-label="Idioma">
      <span class="active" data-lang="es">ES</span>
      <span data-lang="en">EN</span>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="hero">
    <div>
      <h1 data-es="Level Up"
          data-en="Level Up">Level Up</h1>
      <p data-es="Esto convierte tu venta en un juego: el cliente sube de nivel completando acciones reales del proyecto. Mientras m√°s avanza, m√°s desbloquea."
         data-en="Turn your sales into a game: clients level up by completing real project actions. The more they progress, the more they unlock.">
        Esto convierte tu venta en un juego: el cliente sube de nivel completando acciones reales del proyecto. Mientras m√°s avanza, m√°s desbloquea.
      </p>
    </div>
    <div class="statusLine" id="statusLine">Cargando‚Ä¶</div>
  </div>

  <section class="grid">

    <!-- XP / HUD -->
    <div class="card col-7" id="xpCard">
      <div class="hudTop">
        <div class="rank" id="rank">START</div>
        <div class="next" id="next">FALTAN 0 XP</div>
      </div>
      <div class="bar"><div class="fill" id="fill"></div></div>

      <div class="tags">
        <div class="tag"><span data-es="PRO" data-en="PRO">PRO</span>: <b data-es="entrega m√°s r√°pida" data-en="faster delivery">entrega m√°s r√°pida</b></div>
        <div class="tag"><span data-es="VIP" data-en="VIP">VIP</span>: <b data-es="prioridad + automatizaciones" data-en="priority + automations">prioridad + automatizaciones</b></div>
        <div class="tag"><span data-es="ELITE" data-en="ELITE">ELITE</span>: <b data-es="funnel + optimizaci√≥n" data-en="funnel + optimization">funnel + optimizaci√≥n</b></div>
      </div>
    </div>

    <!-- MISSIONS -->
    <div class="card col-5">
      <div class="head">
        <h3 data-es="Misiones" data-en="Missions">Misiones</h3>
        <span data-es="Reclama XP (demo)" data-en="Claim XP (demo)">Reclama XP (demo)</span>
      </div>

      <div class="mission">
        <div class="mTxt">
          <strong data-es="Completar briefing" data-en="Complete briefing">Completar briefing</strong>
          <small data-es="+40 XP ¬∑ define objetivos, p√∫blico y estilo"
                 data-en="+40 XP ¬∑ define goals, audience and style">+40 XP ¬∑ define objetivos, p√∫blico y estilo</small>
        </div>
        <button class="btn" id="mBrief" data-es="Reclamar" data-en="Claim">Reclamar</button>
      </div>

      <div class="mission">
        <div class="mTxt">
          <strong data-es="Subir logo + marca" data-en="Upload logo + brand">Subir logo + marca</strong>
          <small data-es="+60 XP ¬∑ logo, colores, referencias"
                 data-en="+60 XP ¬∑ logo, colors, references">+60 XP ¬∑ logo, colores, referencias</small>
        </div>
        <button class="btn" id="mBrand" data-es="Reclamar" data-en="Claim">Reclamar</button>
      </div>

      <div class="mission">
        <div class="mTxt">
          <strong data-es="Aprobar dise√±o" data-en="Approve design">Aprobar dise√±o</strong>
          <small data-es="+80 XP ¬∑ apruebas el mockup y avanzamos"
                 data-en="+80 XP ¬∑ approve the mockup and we move forward">+80 XP ¬∑ apruebas el mockup y avanzamos</small>
        </div>
        <button class="btn" id="mApprove" data-es="Reclamar" data-en="Claim">Reclamar</button>
      </div>

      <div class="mission">
        <div class="mTxt">
          <strong data-es="Cliente activo (mensual)" data-en="Active client (monthly)">Cliente activo (mensual)</strong>
          <small data-es="+40 XP ¬∑ mantener el nivel activo"
                 data-en="+40 XP ¬∑ keep your level active">+40 XP ¬∑ mantener el nivel activo</small>
        </div>
        <button class="btn" id="mKeep" data-es="Reclamar" data-en="Claim">Reclamar</button>
      </div>

      <div class="mission">
        <div class="mTxt">
          <strong data-es="Recomendar ZenSite" data-en="Refer ZenSite">Recomendar ZenSite</strong>
          <small data-es="+40 XP ¬∑ crucial: ganas t√∫ y gano yo üòè"
                 data-en="+40 XP ¬∑ crucial: you win and I win üòè">+40 XP ¬∑ crucial: ganas t√∫ y gano yo üòè</small>
        </div>
        <button class="btn" id="mRefer" data-es="Reclamar" data-en="Claim">Reclamar</button>
      </div>
    </div>

    <!-- LEVELS -->
    <div class="card col-12 levels">
      <h3 data-es="Beneficios por nivel" data-en="Benefits by level">Beneficios por nivel</h3>

      <div class="lGrid">
        <div class="level" id="lv1">
          <div class="badge" data-es="Nivel 1" data-en="Level 1">Nivel 1</div>
          <h4 data-es="Start" data-en="Start">Start</h4>
          <ul>
            <li data-es="‚úî Acceso al portal del proyecto"
                data-en="‚úî Access to the project portal">‚úî Acceso al portal del proyecto</li>
            <li data-es="‚úî Ver demos y estructura"
                data-en="‚úî View demos and structure">‚úî Ver demos y estructura</li>
            <li data-es="‚úñ Sin prioridad"
                data-en="‚úñ No priority">‚úñ Sin prioridad</li>
          </ul>
        </div>

        <div class="level" id="lv2">
          <div class="badge" data-es="PRO (180 XP)" data-en="PRO (180 XP)">PRO (180 XP)</div>
          <h4>PRO</h4>
          <ul>
            <li data-es="‚úî Prioridad de producci√≥n"
                data-en="‚úî Production priority">‚úî Prioridad de producci√≥n</li>
            <li data-es="‚úî Entrega m√°s r√°pida"
                data-en="‚úî Faster delivery">‚úî Entrega m√°s r√°pida</li>
            <li data-es="‚úî Cambios prioritarios"
                data-en="‚úî Priority revisions">‚úî Cambios prioritarios</li>
          </ul>
        </div>

        <div class="level vipPlan" id="lv3">
          <div class="crown">üëë</div>
          <div class="badge" data-es="VIP (300 XP)" data-en="VIP (300 XP)">VIP (300 XP)</div>
          <h4>VIP</h4>
          <ul>
            <li data-es="‚úî Automatizaciones + integraciones"
                data-en="‚úî Automations + integrations">‚úî Automatizaciones + integraciones</li>
            <li data-es="‚úî Prioridad total"
                data-en="‚úî Full priority">‚úî Prioridad total</li>
            <li data-es="‚úî Setup premium (dominio/hosting/forms)"
                data-en="‚úî Premium setup (domain/hosting/forms)">‚úî Setup premium (dominio/hosting/forms)</li>
          </ul>
        </div>
      </div>

      <div class="portals">
        <div class="portal">
          <h4 data-es="Portal del proyecto" data-en="Project portal">Portal del proyecto</h4>
          <p data-es="Aqu√≠ el cliente ve: tareas, progreso, revisiones y desbloqueos. Esto es lo que engancha."
             data-en="Clients see: tasks, progress, revisions and unlocks. This is what keeps them hooked.">
            Aqu√≠ el cliente ve: tareas, progreso, revisiones y desbloqueos. Esto es lo que engancha.
          </p>
          <a class="btn" href="#" id="fakePortal" data-es="Ver demo" data-en="View demo">Ver demo</a>
        </div>

        <div class="portal">
          <h4 data-es="Desbloqueo visual" data-en="Visual unlock">Desbloqueo visual</h4>
          <p data-es="Cada nivel activa efectos, badges y prioridad. No vendes una web: vendes estatus y progreso."
             data-en="Each level activates effects, badges and priority. You‚Äôre not selling a website: you‚Äôre selling status and progress.">
            Cada nivel activa efectos, badges y prioridad. No vendes una web: vendes estatus y progreso.
          </p>
          <a class="btn" href="#" id="reset" data-es="Reset demo" data-en="Reset demo">Reset demo</a>
        </div>
      </div>
    </div>

    <!-- COPY -->
    <div class="card col-12" style="text-align:center">
      <div style="font-weight:950;letter-spacing:.22em;text-transform:uppercase;font-size:12px;opacity:.9;margin-bottom:10px"
           data-es="Esto es un sistema de venta"
           data-en="This is a sales system">
        Esto es un sistema de venta
      </div>
      <div style="opacity:.75;max-width:920px;margin:0 auto;font-size:14px;line-height:1.85">
        <span data-es="Cada proyecto se construye desde cero, personalizado y conectado como debe ser: dominio, hosting, formularios, pagos, automatizaciones y escalabilidad."
              data-en="Each project is built from scratch, fully customized and properly connected: domain, hosting, forms, payments, automations and scalability.">
          Cada proyecto se construye desde cero, personalizado y conectado como debe ser: dominio, hosting, formularios, pagos, automatizaciones y escalabilidad.
        </span>
      </div>
    </div>

  </section>

  <footer>¬© 2025 ZenSite ¬∑ Level Up System</footer>
</div>

<div class="toast" id="toast">
  <b id="toastTitle">+XP</b><span id="toastText">Actualizado</span>
</div>

<script>
/* =========================
   STATE (LOCAL)
========================= */
const KEY = "zensite_levelup_v1";
const DEFAULT = {
  xp: 0,
  streak: 0,
  lastBriefDay: "",
  lastBrandDay: "",
  lastApproveDay: "",
  lastKeepMonth: "",
  lastReferDay: ""
};

function dayId(t=Date.now()){
  const d = new Date(t);
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
}
function monthId(t=Date.now()){
  const d = new Date(t);
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}
function load(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return {...DEFAULT};
    return {...DEFAULT, ...JSON.parse(raw)};
  }catch(e){ return {...DEFAULT}; }
}
function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

/* =========================
   LEVELS
   PRO: 180 XP
   VIP: 300 XP
========================= */
function getRank(xp){
  if(xp >= 300) return {name:"VIP", level:3, next:null};
  if(xp >= 180) return {name:"PRO", level:2, next:300};
  return {name:"START", level:1, next:180};
}
function percent(xp){
  return Math.max(0, Math.min(100, (xp/300)*100));
}

/* =========================
   I18N
========================= */
let lang = "es";
const langBtns = document.querySelectorAll(".lang span");
const transEls = document.querySelectorAll("[data-es]");

function setLang(l){
  lang = l;
  langBtns.forEach(b=>b.classList.toggle("active", b.dataset.lang===l));
  transEls.forEach(el => { el.textContent = el.dataset[l]; });
  // also update dynamic button labels if disabled
  refreshButtons(state);
  render(state, false, true);
}
langBtns.forEach(b=>b.addEventListener("click", ()=>setLang(b.dataset.lang)));

/* =========================
   UI refs
========================= */
const elXP = document.getElementById("xp");
const elStreak = document.getElementById("streak");
const elRank = document.getElementById("rank");
const elNext = document.getElementById("next");
const elFill = document.getElementById("fill");
const statusLine = document.getElementById("statusLine");
const xpCard = document.getElementById("xpCard");

const lv1 = document.getElementById("lv1");
const lv2 = document.getElementById("lv2");
const lv3 = document.getElementById("lv3");

const toast = document.getElementById("toast");
const toastTitle = document.getElementById("toastTitle");
const toastText = document.getElementById("toastText");

/* =========================
   Toast
========================= */
function showToast(title, text){
  toastTitle.textContent = title;
  toastText.textContent = text;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 2200);
}

/* =========================
   Number animation
========================= */
function animateNumber(el, from, to){
  const diff = to - from;
  const steps = Math.min(42, Math.max(14, Math.floor(Math.abs(diff)/5)));
  let i = 0;
  const t = setInterval(()=>{
    i++;
    const v = Math.round(from + diff*(i/steps));
    el.textContent = v;
    if(i>=steps){ el.textContent = to; clearInterval(t); }
  }, 18);
}

/* =========================
   FX Confetti + SFX
========================= */
const fx = document.getElementById("fx");
const ctx = fx.getContext("2d");
function resizeFX(){
  fx.width = innerWidth * devicePixelRatio;
  fx.height = innerHeight * devicePixelRatio;
}
addEventListener("resize", resizeFX);
resizeFX();

let conf = [];
function popConfetti(kind="white"){
  conf = [];
  const count = 150;
  for(let i=0;i<count;i++){
    conf.push({
      x:(Math.random()*innerWidth)*devicePixelRatio,
      y:(-30 - Math.random()*240)*devicePixelRatio,
      vx:(-1 + Math.random()*2)*devicePixelRatio*1.25,
      vy:(2 + Math.random()*5)*devicePixelRatio,
      r:(2 + Math.random()*4)*devicePixelRatio,
      rot:Math.random()*Math.PI,
      vr:(-.2 + Math.random()*.4),
      life:160 + Math.random()*90,
      kind,
      gold:Math.random()>.55
    });
  }
  renderConfetti();
  clickBeep("level");
}
function renderConfetti(){
  ctx.clearRect(0,0,fx.width,fx.height);
  conf.forEach(p=>{
    p.x += p.vx; p.y += p.vy; p.rot += p.vr;
    p.vy *= 1.01; p.life -= 1;

    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.globalAlpha = Math.max(0, Math.min(1, p.life/240));
    let col = "rgba(255,255,255,.95)";
    if(document.body.classList.contains("vip")) col = p.gold ? "rgba(255,215,0,.95)" : "rgba(255,255,255,.95)";
    if(document.body.classList.contains("elite")) col = "rgba(126,252,255,.95)";
    ctx.fillStyle = col;
    ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*1.2);
    ctx.restore();
  });
  conf = conf.filter(p=>p.life>0 && p.y < fx.height+320);
  if(conf.length) requestAnimationFrame(renderConfetti);
  else ctx.clearRect(0,0,fx.width,fx.height);
}

/* Subtle UI sound (works after user gesture on iOS) */
let audioCtx = null;
function getAC(){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  return audioCtx;
}
function clickBeep(type="click"){
  try{
    const ac = getAC();
    const o = ac.createOscillator();
    const g = ac.createGain();
    o.type = "sine";

    const now = ac.currentTime;
    const base = (type==="level") ? 880 : 660;
    o.frequency.setValueAtTime(base, now);
    o.frequency.exponentialRampToValueAtTime(base*0.78, now+0.08);

    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.03, now+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now+0.12);

    o.connect(g); g.connect(ac.destination);
    o.start(now);
    o.stop(now+0.14);
  }catch(e){}
}

/* =========================
   Buttons (daily/monthly locks)
========================= */
const mBrief   = document.getElementById("mBrief");
const mBrand   = document.getElementById("mBrand");
const mApprove = document.getElementById("mApprove");
const mKeep    = document.getElementById("mKeep");
const mRefer   = document.getElementById("mRefer");

function setBtnState(btn, done){
  if(done){
    btn.disabled = true;
    btn.textContent = (lang==="es") ? "HECHO" : "DONE";
  }else{
    btn.disabled = false;
    btn.textContent = (lang==="es") ? "RECLAMAR" : "CLAIM";
  }
}
function refreshButtons(s){
  const today = dayId();
  setBtnState(mBrief,   s.lastBriefDay === today);
  setBtnState(mBrand,   s.lastBrandDay === today);
  setBtnState(mApprove, s.lastApproveDay === today);
  setBtnState(mRefer,   s.lastReferDay === today);

  const thisMonth = monthId();
  setBtnState(mKeep, s.lastKeepMonth === thisMonth);
}

/* =========================
   Render
========================= */
function render(s, leveled=false, silent=false){
  const r = getRank(s.xp);

  const prevXP = Number(elXP.textContent || 0);
  if(!silent) animateNumber(elXP, prevXP, s.xp);
  else elXP.textContent = s.xp;

  elStreak.textContent = s.streak;

  elRank.textContent = r.name;
  elFill.style.width = `${percent(s.xp)}%`;

  // body modes
  document.body.classList.toggle("pro", r.level===2);
  document.body.classList.toggle("vip", r.level===3);
  document.body.classList.toggle("elite", false); // reservado si luego haces ELITE

  // next line + status
  if(r.level === 3){
    elNext.textContent = (lang==="es") ? "MODO VIP ACTIVO" : "VIP MODE ACTIVE";
    statusLine.textContent = (lang==="es")
      ? "VIP activo ¬∑ prioridad total + automatizaciones"
      : "VIP active ¬∑ full priority + automations";
  }else if(r.level === 2){
    elNext.textContent = (lang==="es") ? `FALTAN ${300 - s.xp} XP PARA VIP` : `${300 - s.xp} XP TO VIP`;
    statusLine.textContent = (lang==="es")
      ? "PRO activo ¬∑ entrega m√°s r√°pida + prioridad"
      : "PRO active ¬∑ faster delivery + priority";
  }else{
    elNext.textContent = (lang==="es") ? `FALTAN ${180 - s.xp} XP PARA PRO` : `${180 - s.xp} XP TO PRO`;
    statusLine.textContent = (lang==="es")
      ? "START ¬∑ desbloquea tu proyecto completando misiones"
      : "START ¬∑ unlock your project by completing missions";
  }

  // highlight levels + crown
  [lv1,lv2,lv3].forEach(x=>x.classList.remove("now","vipOn"));
  if(r.level===1) lv1.classList.add("now");
  if(r.level===2) lv2.classList.add("now");
  if(r.level===3){ lv3.classList.add("now","vipOn"); }

  // card shake
  xpCard.classList.remove("shake");
  void xpCard.offsetWidth;
  xpCard.classList.add("shake");

  if(leveled){
    popConfetti();
    showToast(
      (lang==="es") ? "SUBISTE DE NIVEL" : "LEVEL UP",
      (r.level===3)
        ? ((lang==="es") ? "VIP desbloqueado üëë" : "VIP unlocked üëë")
        : ((lang==="es") ? "PRO desbloqueado" : "PRO unlocked")
    );
  }

  save(s);
}

/* =========================
   XP add
========================= */
function addXP(amount){
  const before = getRank(state.xp).level;
  state.xp += amount;
  state.streak += 1;
  const after = getRank(state.xp).level;

  clickBeep("click");
  render(state, after>before, false);

  showToast(`+${amount} XP`, (lang==="es") ? "Progreso guardado (demo)." : "Progress saved (demo).");
  refreshButtons(state);
}

/* =========================
   Events
========================= */
let state = load();
refreshButtons(state);

mBrief.addEventListener("click", ()=>{
  const today = dayId();
  if(state.lastBriefDay === today) return;
  state.lastBriefDay = today;
  addXP(40);
});

mBrand.addEventListener("click", ()=>{
  const today = dayId();
  if(state.lastBrandDay === today) return;
  state.lastBrandDay = today;
  addXP(60);
});

mApprove.addEventListener("click", ()=>{
  const today = dayId();
  if(state.lastApproveDay === today) return;
  state.lastApproveDay = today;
  addXP(80);
});

mKeep.addEventListener("click", ()=>{
  const m = monthId();
  if(state.lastKeepMonth === m) return;
  state.lastKeepMonth = m;
  addXP(40);
});

mRefer.addEventListener("click", ()=>{
  const today = dayId();
  if(state.lastReferDay === today) return;
  state.lastReferDay = today;
  addXP(40);
});

/* Fake portal + reset */
document.getElementById("fakePortal").addEventListener("click",(e)=>{
  e.preventDefault();
  clickBeep("click");
  showToast((lang==="es")?"PORTAL":"PORTAL",(lang==="es")?"Aqu√≠ ir√≠a tu portal real.":"Your real portal goes here.");
});

document.getElementById("reset").addEventListener("click",(e)=>{
  e.preventDefault();
  clickBeep("click");
  localStorage.removeItem(KEY);
  state = load();
  refreshButtons(state);
  render(state,false,false);
  showToast((lang==="es")?"RESET":"RESET",(lang==="es")?"Demo reiniciada.":"Demo reset.");
});

/* Initial */
render(state,false,true);
setLang("es");
</script>

</body>
</html>